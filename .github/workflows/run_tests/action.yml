runs:
  using: "composite"
  steps:
    - name: Run unit tests
      run: |
          cd ${GITHUB_WORKSPACE}/build
          ctest --output-on-failure
      shell: bash

    - name: Run valgrind test
      run: |
          cd ${GITHUB_WORKSPACE}/build/examples/prom
          echo "::group::Valgrind - Poisson Global PROM - Offline"
          valgrind --leak-check=full --track-origins=yes ./poisson_global_rom -offline -f 1.0 -id 0
          echo "::endgroup::"
          ./poisson_global_rom -offline -f 1.1 -id 1
          ./poisson_global_rom -offline -f 1.2 -id 2
          ./poisson_global_rom -merge -ns 3
          echo "::group::Valgrind - Poisson Global PROM - Online"
          valgrind --leak-check=full --track-origins=yes ./poisson_global_rom -online -f 1.15
          echo "::endgroup::"
      shell: bash

    - name: Run regression tests
      if: ${{ github.event.label.name == 'LGTM' || contains(github.event.pull_request.labels.*.name, 'LGTM') }}
      run: |
          cd ${GITHUB_WORKSPACE}
          ./regression_tests/run_regression_tests.sh

      shell: bash
