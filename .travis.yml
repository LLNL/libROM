language: cpp
sudo: false
dist: trusty

cache:
  apt: true
  directories:
    - $HOME/.cache

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - g++-4.9
      - gfortran-4.9
      - libblas-dev
      - liblapack-dev
      - libopenmpi-dev
      - libhdf5-serial-dev
      - environment-modules

env:
  global:
    - SPACK_ROOT: $HOME/.cache/spack
    - PATH: $PATH:$HOME/.cache/spack/bin

before_install:
  - export CXX=g++-4.9
  - export CC=gcc-4.9
  - export FC=gfortran-4.9
  - export F77=gfortran-4.9
  - export CXXFLAGS="-std=c++11"
  - which g++
  - which gcc
  - which gfortran
  - which f77
  - which h5cc
  - which h5fc

script:
  - cd $TRAVIS_BUILD_DIR
  - ./autogen.sh
  - ./configure --with-CXX=/usr/bin/mpic++ --with-hdf5=/usr/bin/h5cc --with-lapack='-lopenblas' || cat config.log
